# Goal: Convert PDF file into a .txt file
# URL: https://www.ajax.ca/en/home-and-property/resources/Planning/TOA_ZBL-Consolidation_November-1-2023.pdf

 # Step 1: pip install pymupdf via terminal

# Step 2: All Below
 
import fitz  # PyMuPDF
import re


def pdf_to_txt_pymupdf(pdf_path, output_txt_path):
    doc = fitz.open(pdf_path)
    text = []

    for page_num in range(doc.page_count):
        page = doc[page_num]
        text.append(page.get_text())

    full_text = '\n\n'.join(text)
    doc.close()

    with open(output_txt_path, 'w', encoding='utf-8') as txt_file:
        txt_file.write(full_text)

    return full_text


def clean_text_for_llm(text):
    # Remove excessive whitespace
    text = re.sub(r'\s+', ' ', text)

    # Remove page numbers (adjust pattern as needed)
    text = re.sub(r'\n\d+\n', '\n', text)

    # Remove special characters if needed
    # text = re.sub(r'[^\w\s.,!?-]', '', text)

    return text.strip()


# Usage
text = pdf_to_txt_pymupdf('zoning_bylaw.pdf', 'zoning_bylaw.txt')

# After extraction
cleaned_text = clean_text_for_llm(text)
with open('cleaned_output.txt', 'w', encoding='utf-8') as f:
    f.write(cleaned_text)
